<!DOCTYPE HTML>
<!--
	Phantom by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->

<!-- OK YES I BASED MY WEBSITE OFF A TEMPLATE BUT IM A MECHE MAJOR NOT A CS MAJOR SUE ME HEY WHY ARE YOU LURKING HERE IN THE FIRST PLACE -->
<html>
	<head>
		<title>IK Drawing Robot - Katie Kostak</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="inner">
							<!-- Logo -->
							<a href="index.html" class="logo">
								<span class="symbol"><img src="images/logo.png" alt="" /></span><span class="title">Katie!</span>
							</a>
							<!-- Nav -->
								<nav>
									<ul>
										<li><a href="#menu">Menu</a></li>
									</ul>
								</nav>

						</div>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<h2>Menu</h2>
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="aboutMe.html">About Me</a></li>
							<li><a href="https://docs.google.com/document/d/1IWItMeYGe21i9kFOkmaiU_o10JnmGZ0ZCY9t4pEIM1M/edit?usp=sharing">Resume</a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">
						<div class="inner">
							<h1>IK Drawing Robot</h1>

							<div style="display: inline-block; width: 875pt;">
								<p><span class="image right"><video style = "width: 450px; height: 350px; object-fit: cover; object-position: 50% 75%"autoplay muted loop><source src="images/ME35/2dof/demo.mp4"></video></span> <b>GOALS: </b> Design a robot that can draw a shape using inverse kinematics <br> <b>SKILLS: </b> CAD, Kinematics, MATLAB, MicroPython, ESP32</p>
								<p> This was a 2-week long project for my Introductory Robotics class. The requirements for this project were just to create a 2-degree-of-freedom arm that uses inverse kinematics (IK) to control the end effector to draw a shape.  </p>
							</div>		

							<div>
								<h2>Kinematics Theory</h2>
									<p>Here's the IK I used to correlate an end effector point to servo angles. It's essentially just a bit of trigonometry.</p>

									<p><span class="image left"><img src="images/ME35/2dof/MathDiagram.png" alt="" /></span> </p>	
									<p>Using Pythagorean Theorem, Arctan, and Law of Cosines:</p>		
									
									<div class = "row">
										<div class = "column">
											<blockquote> <math display = "block">
												<mrow>
													<mi>c</mi>
													<mo>=</mo>
													<msqrt>
													  <msup><mi>x</mi><mn>2</mn></msup>
													  <mo>+</mo>
													  <msup><mi>y</mi><mn>2</mn></msup>
													</msqrt>
												</mrow>
											</math></blockquote>
										</div>
										<div class = "column">
											<math display = "block">
												<mrow>
													<mi>e</mi>
													<mo>=</mo>
													<msqrt>
													  <msup>
														<mrow><mo>(</mo><mi>d</mi><mo>−</mo><mi>x</mi><mo>)</mo></mrow>
														<mn>2</mn>
													  </msup>
													  <mo>+</mo>
													  <msup><mi>y</mi><mn>2</mn></msup>
													</msqrt>
												  </mrow>
											</math>
										</div>
									</div>

									<div class = "row">
										<div class = "column">
											<blockquote><math>
												<mrow>
													<mi>b₁</mi>
													<mo>=</mo>
													<mi>atan2</mi><mo>(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>)</mo>
												</mrow>
											</math></blockquote>
										</div>
										<div class = "column">	
											<math>
												<mrow>
													<mi> a₁</mi>
													<mo>=</mo>
													<mi>atan2</mi><mo>(</mo><mi>y</mi><mo>,</mo><mi>d</mi><mo>−</mo><mi>x</mi><mo>)</mo>
												</mrow>
											</math>											  
										</div>
									</div>

									<div class = "row">
										<div class = "column">
											<blockquote><math>
												<mrow>
													<mi>a₂</mi>
													<mo>=</mo>
													<mi>acos</mi>
													<mo>(</mo>
													<mfrac>
													  <mi>e</mi>
													  <mrow><mn>2</mn><mi>L</mi></mrow>
													</mfrac>
													<mo>)</mo>
												</mrow>
											</math></blockquote>
										</div>
										<div class = "column">
											<math>
												<mrow>
													<mi>b₂</mi>
													<mo>=</mo>
													<mi>acos</mi>
													<mo>(</mo>
													<mfrac>
													  <mi> c</mi>
													  <mrow><mn>2</mn><mi>L</mi></mrow>
													</mfrac>
													<mo>)</mo>
												</mrow>
											</math>
										</div>
									</div>

									<br>

								<h2> MATLAB Simulation </h2>
									<p><span class="image right"><video name="badROM" style = "width: 450px; height: 350px; object-fit: cover; object-position: 0% 50%"autoplay muted loop><source src="images/ME35/2dof/MATLAB Demo.mov"></video></span><br>Before going straight to incorporating the kinematics with the mechanical system, I wanted to simulate everything in MATLAB to make sure that my logic was sound. So I made a MATLAB script that models the linkage system, and you can input an array of points and it will draw it out! Let it be known that this was programmed by hand, and the only time AI was used was to generate the array of points for the star shape. <p>
									<br>
										<a id = "showButton" href="javascript:" onClick="document.getElementById('matlab').style.display='inline-block'; document.getElementById('micropython').style.display='none'; document.getElementById('hideButton').style.display='inline-block';" class="button small primary">MATLAB code!</a>
										<a id = "showButton" href="javascript:" onClick="document.getElementById('micropython').style.display='inline-block'; document.getElementById('matlab').style.display='none'; document.getElementById('hideButton').style.display='inline-block';" class="button small primary">MicroPython code!</a>
										<a id = "hideButton" href="javascript:" style = "display: none;" onClick="document.getElementById('matlab').style.display='none'; document.getElementById('micropython').style.display='none'; document.getElementById('hideButton').style.display='none';" class="button small primary">hide code</a>

										<div id = 'matlab' style = "display: none">
											<pre><code>
% endefactor coordinates
x = 75;
y = 120;

% Linkage parameters
L = 122.125;
d = 100;

% Array of points we want to move to
vertLine = [50 180; 50 150; 50 120; 50 90; 50 60; 50 30;];
horizLine = [-10 150; 0 150; 20 150; 40 150; 60 150; 80 150; 100 150; 120 150;];
square = [-25 25; 125 25; 125 200; -25 200; -25 25];

circle = generate_circle([50, 175], 25, 5);
star = generate_star([50, 150], 25, 50, 5, 5);


% Setting up plot
figure;
axis equal;
axis([  -200 300 -200 500]);
grid on;
hold on;

animateShape(star, d, L);

disp(star);

function animateShape(points, d, L)
for i = 1:size(points, 1)
	cla;
	for j = 1:i
		plot(points(j, 1), points(j,2), 'go', 'MarkerSize', 2, 'MarkerFaceColor', 'g');
	end

	x = points(i, 1);
	y = points(i, 2);

	% plotting servo links
	angles = findAngles(x, y, d, L);
	joint1 = drawLinkage(angles(2), 0, 0, L);
		% disp("Joint1 endPoints: " + joint1)
	joint2 = drawLinkage(angles(1), d, 0, L);
		% disp("Joint2 endPoints: " + joint2)

	% plotting endefactor links
	plot([joint1(1) x], [joint1(2) y], 'b-', 'LineWidth', 3);
		% disp("Length of Endefactor Linkage:" + sqrt((joint1(1) - x)^2 + (joint1(2) - y)^2))
	plot([joint2(1) x], [joint2(2) y], 'b-', 'LineWidth', 3);
		% disp("Length of Endefactor Linkage:" + sqrt((joint2(1) - x)^2 + (joint2(2) - y)^2))
	plot(x, y, 'ro', 'MarkerFaceColor', 'r'); % endefactor joint
	
	pause(0.01);
end

end

function endPoints = drawLinkage(theta, xo, yo, L)

% Doing trig to find the end point of linkage
xf = xo - L*cos(theta);
yf = yo + L*sin(theta);

% plotting linkage
plot([xo xf], [yo yf], 'b-', 'LineWidth', 3);
plot(xo, yo, 'ro', 'MarkerFaceColor', 'r'); % base joint
plot(xf, yf, 'ko', 'MarkerFaceColor', 'k'); % end joint

% disp("Length of Servo Linkage:" + sqrt((xo - xf)^2 + (yo - yf)^2))

endPoints = [xf, yf];

end

% input the endefactor coordinates, distance between, and length of arms 
% output the two servo angles from the left face to ground
function angles = findAngles(x, y, d, L)

% inverse pythag on inner triangle // this is good
b_c = sqrt(x^2 + y^2);
a_e = sqrt((d - x)^2 + y^2);

% find the inner angles on inner triangle // this is good
b1 = atan2(y, x);
a1 = atan2(y, d-x);

% law of cosines to find the middle angle //maybe not?                                                                                                                        a
a2 = acos(a_e/(2*L));
b2 = acos(b_c/(2*L));

% weird conditional stuff
af = (a1 + a2);
bf  = pi - (b1 + b2);

% if x < 0
%     af = pi + (a1 + a2);
%     bf  = pi - (b1 + b2);
% elseif x > d
%     af = (a1 + a2);
%     bf  = -1 * (b1 + b2);
% end

angles = [af, bf];
disp(angles)
% disp("Angles (rad): " + angles)
% disp("Angles (deg): " + rad2deg(angles))
end


% These last two functions are AI Generated - used to create an array of
% points for the linkages to move to

function points = generate_circle(origin, r, spacing)       

circumference = 2 * pi * r;
numPoints = round(circumference / spacing);

theta = linspace(0, 2*pi, numPoints+1);  % +1 to close the circle

x = origin(1) + r * cos(theta);
y = origin(2) + r * sin(theta);

points = [x(:), y(:)];
end

function star_points = generate_star(origin, r_outer, r_inner, num_points, spacing)
%GENERATE_STAR Generates coordinates for a star outline
%
% INPUTS:
%   origin    - [x0, y0] center of the star
%   r_outer   - radius of the star's outer points
%   r_inner   - radius of the star's inner points
%   num_points- number of star points (5 for classic star)
%   spacing   - approximate distance between points along the outline
%
% OUTPUT:
%   star_points - N×2 array of [x y] coordinates along the star outline

% Step 1: Generate outer and inner points
angles_outer = (0:num_points-1)*(2*pi/num_points) - pi/2; % start top
x_outer = origin(1) + r_outer*cos(angles_outer);
y_outer = origin(2) + r_outer*sin(angles_outer);

angles_inner = angles_outer + pi/num_points;
x_inner = origin(1) + r_inner*cos(angles_inner);
y_inner = origin(2) + r_inner*sin(angles_inner);

% Interleave outer and inner points
x_star = zeros(1, num_points*2+1);
y_star = zeros(1, num_points*2+1);
x_star(1:2:end-1) = x_outer;
x_star(2:2:end-1) = x_inner;
x_star(end) = x_outer(1);  % close the star
y_star(1:2:end-1) = y_outer;
y_star(2:2:end-1) = y_inner;
y_star(end) = y_outer(1);

% Step 2: Resample points along the star edges with ~spacing distance
star_points = [];
for i = 1:length(x_star)-1
	% start and end of edge
	p1 = [x_star(i), y_star(i)];
	p2 = [x_star(i+1), y_star(i+1)];
	
	% distance and number of segments
	d = norm(p2 - p1);
	n_seg = max(1, round(d/spacing));  % at least one segment
	
	% interpolate points along the edge
	t = linspace(0, 1, n_seg+1);
	edge_points = (1-t)'*p1 + t'*p2;  % linear interpolation
	star_points = [star_points; edge_points(1:end-1,:)]; % avoid duplicates
end
star_points = [star_points; star_points(1,:)];  % close star
end												
											</code></pre>
										</div>
										<div id = 'micropython' style = "display:none"> 
											<pre style><code>
i havent gotten my micropython script off my esp32 yet, but its more or less similar to the matlab :-)
											</code></pre>
										</div>

								<h2>Hardware</h2>
									<div class="row">
										<div class="column">
											<iframe src="https://tufts597.autodesk360.com/shares/public/SH28cd1QT2badd0ea72bff545daf43e29f86?mode=embed" width="600" height="600" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"  frameborder="0"></iframe>
										</div>
										<div class="column">
											<h3> Mechanical Debugging </h3>
											<video name="badROM" style = "width: 450px; height: 350px; object-fit: cover; object-position: 0% 50%"autoplay muted loop><source src="images/ME35/2dof/badROM.mp4"></video>
											<p> This first prototype of the arm linkages I designed. The issue <br> here was that it didn't have as big a range of motion as I <br> would have liked. I fixed this by giving more space between <br> the linkage and the bearings, and also offsetting the bearing <br> from the arm of the linkage</p>
											<!-- <p> This was the first prototype of the arm linkages I designed. The issue I ran into with this prototype was just that its range of motion was too little for what I wanted to do with it. I fixed this by giving more space between the linkage and the bearings, and also offsetting the bearing from the bearing-holder-linkage</p> -->
										</div>
									  </div>
									
									<h2>that one issue that drove me crazy</h2>
									<p><span class="image left"><img src="images/ME35/2dof/star.png" alt="" /></span>Ok do you see how the star is warped? Like its kind of squished in the Y axis? I spent SO LONG trying to figure out why this was happening. The MATLAB simulation helped me prove it wasn't a code issue, and when I was looking at the mechanical system I realized that I think this five-bar linkage setup is a little fundamentally flawed. Especially compared to the X-axis, the Y-axis is controlled by such minute changes in servo angles that it makes it really hard to accurately control - especially given the generic servo motors that I had. I think if I had all the time in the world I would experiment with better servo motors with higher step resolution, or potentially switching to motors and trying to do some fancy gear ratio stuff. </p>	


							</div>
						</div>
					</div>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<section>
								<h2>Say Hello!</h2>
								<form method="POST" action="https://api.web3forms.com/submit">
									<input type="hidden" name="access_key" value="2b855186-d1af-448e-a3bb-deb242a65f9d">

									<div class="fields">
										<div class="field half">
											<input type="text" name="name" id="name" placeholder="Name" />
										</div>
										<div class="field half">
											<input type="email" name="email" id="email" placeholder="Email" />
										</div>
										<div class="field">
											<textarea name="message" id="message" placeholder="Message"></textarea>
										</div>
									</div>

									<!-- Honeypot Spam Protection -->
									<input type="checkbox" name="botcheck" class="hidden" style="display: none;">

									<ul class="actions">
										<li><input type="submit" value="Send" class="primary" /></li>
									</ul>
								</form>

								
								<ul class="copyright">
									<li>Built by Katie Kostak :-)</li>
								</ul>
							</section>
							<section>
								<h2>Stay in Touch</h2>
								<ul class="icons">
									<li><a href="https://github.com/kkostak" class="icon brands style2 fa-github"><span class="label">GitHub</span></a></li>
									<li><a href="https://katie.kostak@gmail.com" class="icon solid style2 fa-envelope"><span class="label">Email</span></a></li>
									<li><a href="https://www.linkedin.com/in/katiekostak" class="icon brands style2 fa-linkedin"><span class="label">LinkedIn</span></a></li>
									<div class="box alt">
									<div class="col-4"><span class="image fit"><img src="images/bottomLabel.png" alt="" /></span></div>
									</div>
								</ul>
							</section>
						</div>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>